var C=Object.defineProperty;var B=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(B(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();class y{constructor(t,e){r(this,"container");r(this,"children",[]);r(this,"config",{xMove:!0,yMove:!0,basis:"auto",moveRatio:.08,anchorDepth:50,updateInterval:60});r(this,"temp",{moveDistanceBasis:0,containerObserver:null,childWidth:0,childHeight:0,childLeft:0,childTop:0});r(this,"intervalId",0);r(this,"xRatio",0);r(this,"yRatio",0);r(this,"halfPI",Math.PI/2);Object.assign(this.config,e),this.container=t,new ResizeObserver(()=>{this.updateSize()}).observe(this.container),this.intervalId=setInterval(()=>{this.updatePositionEase(this.xRatio,this.yRatio)},this.config.updateInterval)}addChild(t,e){if(!t)return;const i=new z(t);i.depth=e.depth,i.target.style.zIndex=`${e.depth}`,i.target.style.transition=`all 1.5s cubic-bezier(.7,0,.5,1), translate ${this.config.updateInterval+20}ms linear`,setTimeout(()=>{i.target.style.transition=`translate ${this.config.updateInterval+20}ms linear`},1510),this.updateChildSize(i),this.children.push(i)}static computeOffsetMax(t,e,i){const a=e>50?e:100-e,s=(t-e)/a;return i*s}updateSize(){const t=this.container.getBoundingClientRect();let e=this.config.moveRatio*2+1;switch(this.temp.childWidth=Math.ceil(t.width*e),this.temp.childHeight=Math.ceil(t.height*e),this.temp.childLeft=Math.ceil(t.width*this.config.moveRatio),this.temp.childTop=Math.ceil(t.height*this.config.moveRatio),this.config.basis){case"width":this.temp.moveDistanceBasis=t.width*this.config.moveRatio;break;case"height":this.temp.moveDistanceBasis=t.height*this.config.moveRatio;break;case"auto":t.width<t.height?this.temp.moveDistanceBasis=t.width*this.config.moveRatio:this.temp.moveDistanceBasis=t.height*this.config.moveRatio;break;default:this.temp.moveDistanceBasis=0}this.children.forEach(i=>this.updateChildSize(i))}updateChildSize(t){t.target.style.width=`${this.temp.childWidth}px`,t.target.style.height=`${this.temp.childHeight}px`,t.target.style.left=`-${this.temp.childLeft}px`,t.target.style.top=`-${this.temp.childTop}px`,t.offsetMax=y.computeOffsetMax(t.depth,this.config.anchorDepth,this.temp.moveDistanceBasis)}updatePositionEase(t,e){this.updatePosition(Math.sin(this.halfPI*t),Math.sin(this.halfPI*e))}updatePosition(t,e){this.children.forEach(i=>{i.updatePosition(t,e)})}}class z{constructor(t){r(this,"target");r(this,"offsetMax",0);r(this,"depth",0);this.target=t}updatePosition(t,e){this.target.style.translate=`${t*this.offsetMax}px ${e*this.offsetMax}px`}}class h{constructor(t){r(this,"config",{respondRange:80,autoCorrection:!0,autoCorrRange:100});r(this,"temp",{firstEventSkip:!1,initialized:!1,baseAlpha:null,baseBeta:null,baseGamma:null,alphaRatio:0,betaRatio:0,gammaRatio:0});r(this,"listeners",[]);t&&(Object.assign(this.config,t),typeof t.startAlpha=="number"&&(this.temp.baseAlpha=t.startAlpha),typeof t.startBeta=="number"&&(this.temp.baseBeta=t.startBeta),typeof t.startGamma=="number"&&(this.temp.baseGamma=t.startGamma)),window.addEventListener("deviceorientation",e=>{if(!this.temp.firstEventSkip){this.temp.firstEventSkip=!0;return}this.temp.initialized||this.initBase(e),this.handleOrientation(e),this.temp.initialized||(this.temp.initialized=!0)})}static calcDelta(t,e,i){let a=e-t;return a>i/2?a-=i:a<-i/2&&(a+=i),a}initBase(t){const{alpha:e,beta:i,gamma:a}=t;console.log("init",e,i,a),this.temp.baseAlpha==null&&(this.temp.baseAlpha=typeof e=="number"?e:0),this.temp.baseBeta==null&&(this.temp.baseBeta=(typeof i=="number"?i:0)+180),this.temp.baseGamma==null&&(this.temp.baseGamma=(typeof a=="number"?a:0)+90)}static calcNormalize(t,e){return t>e?1:t<-e?-1:0}static calcNormalizeCorr(t,e,i){let a=[0,0];return t>e&&(a[0]=1,t>i&&(a[1]=t-i)),t<-e&&(a[0]=-1,t>i&&(a[1]=-i-t)),a}handleOrientation(t){const{alpha:e,beta:i,gamma:a}=t;let s=h.calcDelta(this.temp.baseAlpha,e,360),c=h.calcDelta(this.temp.baseBeta,i+180,360),l=h.calcDelta(this.temp.baseGamma,a+90,180),[g,b,d]=[s,c,l];const o=this.config.respondRange/2;if(this.config.autoCorrection){const m=this.config.autoCorrRange/2;let p=h.calcNormalizeCorr(s,o,m);p[0]!=0&&(g=o*p[0],this.temp.baseAlpha=this.temp.baseAlpha+p[1]);let u=h.calcNormalizeCorr(c,o,m);u[0]!=0&&(b=o*u[0],this.temp.baseBeta=this.temp.baseBeta+u[1]);let v=h.calcNormalizeCorr(l,o,m);v[0]!=0&&(d=o*v[0],this.temp.baseGamma=this.temp.baseGamma+v[1])}else{let m=h.calcNormalize(s,o);m!=0&&(g=o*m);let p=h.calcNormalize(c,o);p!=0&&(b=o*p);let u=h.calcNormalize(l,o);u!=0&&(d=o*u)}let[R,w,S]=[g/o,b/o,d/o];Object.assign(this.temp,{alphaRatio:R,betaRatio:w,gammaRatio:S}),this.listeners.forEach(m=>m(R,w,S))}addListener(t){this.listeners.push(t),this.temp.initialized&&t(this.temp.alphaRatio,this.temp.betaRatio,this.temp.gammaRatio)}}class f{constructor(t,e){r(this,"target");r(this,"config",{className:"alt",interval:200,randomStart:!1});r(this,"intervalId",0);Object.assign(this.config,e),this.target=t;let i=0;this.config.randomStart&&(i=Math.round(Math.random()*this.config.interval)),console.log(i),setTimeout(()=>{this.intervalId=setInterval(()=>{this.toggleClass()},this.config.interval)},i)}toggleClass(){const t=this.target.className.replace(this.config.className,"");this.target.className==t?this.target.className+=` ${this.config.className}`:this.target.className=t}}window.addEventListener("load",()=>{document.querySelector("#load").innerHTML="载入完毕";const n=document.querySelector("#depth-frame"),t=document.querySelector("#bgrain");new f(t,{randomStart:!0});const e=document.querySelector("#bushsplash");new f(e,{randomStart:!0});const i=document.querySelector("#bushrain");new f(i,{randomStart:!0});const a=document.querySelector("#bellsplash");new f(a,{randomStart:!0});const s=document.querySelector("#mewtwosplash");new f(s,{randomStart:!0});const c=document.querySelector("#fgrain");new f(c,{randomStart:!0});const l=new y(n,{moveRatio:.06,anchorDepth:55});l.addChild(document.querySelector("#bg"),{depth:0}),l.addChild(t,{depth:25}),l.addChild(document.querySelector("#bush"),{depth:40}),l.addChild(e,{depth:42}),l.addChild(i,{depth:50}),l.addChild(document.querySelector("#bell"),{depth:60}),l.addChild(a,{depth:62}),l.addChild(document.querySelector("#mewtwo"),{depth:80}),l.addChild(s,{depth:82}),l.addChild(c,{depth:100}),new h().addListener((b,d,o)=>{l.xRatio=o,l.yRatio=d,l.updatePositionEase(o,d)}),n.className="loaded"});
